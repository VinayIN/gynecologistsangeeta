<!-- theme switcher -->
{{ $class := .Class }} {{ if site.Params.theme_switcher }}
<div class="theme-switcher {{ $class }} invisible">
  <button type="button" data-theme-switcher aria-label="toggle dark mode" aria-pressed="false" class="theme-toggle">
    <span class="sr-only">theme switcher</span>
    <svg class="theme-icon theme-icon-sun" viewBox="0 0 56 56" fill="currentColor" height="18" width="18" aria-hidden="true">
      <path
        d="M30 4.6c0-1-.9-2-2-2a2 2 0 0 0-2 2v5c0 1 .9 2 2 2s2-1 2-2Zm9.6 9a2 2 0 0 0 0 2.8c.8.8 2 .8 2.9 0L46 13a2 2 0 0 0 0-2.9 2 2 0 0 0-3 0Zm-26 2.8c.7.8 2 .8 2.8 0 .8-.7.8-2 0-2.9L13 10c-.7-.7-2-.8-2.9 0-.7.8-.7 2.1 0 3ZM28 16a12 12 0 0 0-12 12 12 12 0 0 0 12 12 12 12 0 0 0 12-12 12 12 0 0 0-12-12Zm23.3 14c1.1 0 2-.9 2-2s-.9-2-2-2h-4.9a2 2 0 0 0-2 2c0 1.1 1 2 2 2ZM4.7 26a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4.9c1 0 2-.9 2-2s-1-2-2-2Zm37.8 13.6a2 2 0 0 0-3 0 2 2 0 0 0 0 2.9l3.6 3.5a2 2 0 0 0 2.9 0c.8-.8.8-2.1 0-3ZM10 43.1a2 2 0 0 0 0 2.9c.8.7 2.1.8 3 0l3.4-3.5c.8-.8.8-2.1 0-2.9-.8-.8-2-.8-2.9 0Zm20 3.4c0-1.1-.9-2-2-2a2 2 0 0 0-2 2v4.9c0 1 .9 2 2 2s2-1 2-2Z"
      />
    </svg>
    <svg class="theme-icon theme-icon-moon" viewBox="0 0 24 24" fill="currentColor" height="18" width="18" aria-hidden="true">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M8.2 2.2c1-.4 2 .6 1.6 1.5-1 3-.4 6.4 1.8 8.7a8.4 8.4 0 0 0 8.7 1.8c1-.3 2 .5 1.5 1.5v.1a10.3 10.3 0 0 1-9.4 6.2A10.3 10.3 0 0 1 3.2 6.7c1-2 2.9-3.5 4.9-4.4Z" />
    </svg>
  </button>
</div>

<script>
  (function () {
    var docEl = document.documentElement;
    var defaultTheme = "{{ site.Params.theme_default }}";
    var storedTheme = localStorage.getItem("theme");
    var mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
    var darkMode = storedTheme === "dark";

    if (storedTheme === null) {
      if (defaultTheme === "dark") {
        darkMode = true;
      } else if (defaultTheme === "system") {
        darkMode = mediaQuery.matches;
      }
    }

    function setTheme(isDark, persist) {
      docEl.classList.toggle("dark", isDark);

      document.querySelectorAll("[data-theme-switcher]").forEach(function (button) {
        button.setAttribute("aria-pressed", String(isDark));
        button.classList.toggle("is-dark", isDark);
      });

      if (persist) {
        localStorage.setItem("theme", isDark ? "dark" : "light");
      }
    }

    setTheme(darkMode, storedTheme !== null);

    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll("[data-theme-switcher]").forEach(function (button) {
        button.addEventListener("click", function () {
          var isDark = !docEl.classList.contains("dark");
          setTheme(isDark, true);
        });
      });

      var syncSystemPreference = function (event) {
        if (localStorage.getItem("theme") === null && defaultTheme === "system") {
          setTheme(event.matches, false);
        }
      };

      if (typeof mediaQuery.addEventListener === "function") {
        mediaQuery.addEventListener("change", syncSystemPreference);
      } else if (typeof mediaQuery.addListener === "function") {
        mediaQuery.addListener(syncSystemPreference);
      }

      document.querySelectorAll(".theme-switcher").forEach(function (container) {
        container.classList.remove("invisible");
      });
    });
  })();
</script>
{{ end }}
